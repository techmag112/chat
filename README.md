# Чат клиент-сервер

Сделано в качестве практического задания на курсе **PHP**

### Примененные технологии
* PHP, Websocket, JS, Docker, Gulp, Webpack, Bootstrap 5.3.

### Реализованный функционал

* Идеалогия ООП (MVC).
* Использование готовых библиотек - delight-im/db (база данных), php-di/php-di (контейнер внедрения зависимостей), tamtamchik/simple-flash (флеш-ссобщения об ошибках), league/plates (темплейты страниц), phpmailer/phpmailer (почтовый клиент), delight-im/auth (авторизация), cboden/ratchet (сервер websocket), axios (передача запросов между фронт и бэкендом).
* Авторизация.
* Защита ввода данных от CSRF атак через верификацию данных авторизации кодированным токеном.
* Хранение паролей в виде хешей. 
* Подтверждение регистрации через указанную почту.
* Возможность правки никнейма пользователя и смены пароля - через левый "гамбургер" (элемент управление).
* Возможность смены аватара пользователя - через левый "гамбургер" (элемент управление).
* Отображение email для других пользователей можно отключить.
* Вывод флеш сообщений о выполнении операции.
* Обмен сообщениями чата производится в реальном времени, в ассинхронном режиме через Websocket сервер (должен быть предварительно запущен!).
* Мгновенная подгрузка сообщений чата без перезагрузки веб-страницы.
* Пользователь можем по правому клику на своих сообщениях: редактировать, удалять, пересылать другим пользователям.
* На каждом чате переключается правым кликом режим оповещения о новых сообщениях "бесшумный-звук". 
* Групповой чат: управление через правый "гамбургер" (элемент управление).
* Отображение статуса чат-сервера в реальном времени.
* Автоматическое переподключение клиента к серверу чат-сервера при потери и воссстановления доступа к серверу.
* Авторазвертывание проекта через Docker.

## Как запустить проект:
# Локально с помощью локального веб-сервера OpenServer
1. Развернуть базу с дампа в корне. 
2. Установить файлы в директорию сервера localhost. При необходимости поправить в файле **/src/Core/Router.php** данные по подключению к базе (логин, пароль, порт). 
3. Установить необходимые зависимости - перейти в терминале в директорию установки и набрать команду **composer install**
4. Запустить в терминале websocket сервис "php chat-server.php"
5. Подключиться с разных браузеров (http://localhost), пароль всех пользователей 123456789
# Авторазвертывание с помощью среды контейнеризации Docker
Благодаря ей загрузка базы данных, ее настроек, настроек серверов http, php и их расширений, запуск websocket как сервиса, а также установка необходимых зависимостей - автоматизировано. В директории docker лежит уже настроенный профиль контейнера.
Необходимо:

1. Скопировать директорию профиля докера со всем содержимым к себе на диск и запустить приложение Docker Desktop.
2. В директорию code скопировать файлы проекта с github (директории **public** и **src** + файлы в корне - **chat-server.php** и **composer.json**), кроме дампа chat.sql. Дамп chat.sql скопировать в директорию data.
3. Через терминал зайти в директорию, где развернут профиль докера. Запустить команду **docker-compose up -d --build** 
Дождаться появления зеленых надписей **Container - Started** и подождать несколько минут, чтобы сервера в контейнерах успешно загрузились. Никаких дополнительных настроек или загрузок данных не требуется, проект сам развернется и подтянет все необходимые данные автоматически.

Проект доступен по адресу **http://localhost** (можно сделать отдельное доменное имя, но придется вмешиваться в настройки hosts Windows). Если выйдет ошибка **connection refusion** - подождите пару минут для запуска базы после старта контейнера.
Последующие остановка / старт проект - команды **docker-compose stop** и **docker-compose start**, набранные через терминал в директории, где развернут профиль докера.
Для контроля состояния/изменения базы используется приложение phpMyAdmin (сервер db2, логин admin пароль 12345) (входит в состав контейнера).
Пароли всех пользователей - 123456789.

## Планируется:
* Добавить индикатор новых сообщений
* Переделка интерфейса в единообразном стиле (окна редактирования и загрузки)
* Добавить создание и удаление групповых чатов
* Отображение статусов состояний пользователей в реальном времени
* Удаление чатов из контактов
* Добавление чатов из общей базы
* Добавление смайликов к чатам
* Добавление аттачей картинок к чатам



